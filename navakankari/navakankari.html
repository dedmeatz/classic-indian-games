<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Navakankari - Bold Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-white: #FFFFFF;
            --teal-primary: #008080;
            --teal-dark: #004C4C;
            --teal-light: #E0F2F2;
            --line-color: #64748b; /* Darker, high-contrast slate for lines */
            --line-thickness: 4px; /* Slightly thicker for better visibility */
            --p1-color: #004C4C;
            --p2-color: #26C6DA;
        }
        body {
            background-color: var(--bg-white);
            font-family: 'Inter', -apple-system, sans-serif;
            touch-action: manipulation;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Removed justify-content: center to pull content to the top */
            min-height: 100vh;
            color: var(--teal-dark);
            margin: 0;
            padding: 0;
        }
        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem; /* Tightened gap */
            width: 100%;
            max-width: 420px;
            padding: 0.5rem 1rem 1rem 1rem; /* Minimal top padding */
        }
        .board-container {
            position: relative;
            width: 92vw;
            max-width: 380px;
            aspect-ratio: 1 / 1;
            background-color: transparent;
        }
        .line {
            position: absolute;
            background-color: var(--line-color);
            z-index: 1;
            border-radius: 4px;
        }
        .node {
            position: absolute;
            width: min(8vw, 32px);
            height: min(8vw, 32px);
            border-radius: 50%;
            background-color: var(--bg-white);
            transform: translate(-50%, -50%);
            z-index: 10;
            cursor: pointer;
            border: 4px solid var(--line-color); 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }
        .node.highlight {
            transform: translate(-50%, -50%) scale(1.2);
            border-color: var(--teal-primary);
            box-shadow: 0 0 0 4px var(--teal-light);
            z-index: 11;
        }
        .piece {
            width: 70%;
            height: 70%;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }
        .piece-player1 { background-color: var(--p1-color); }
        .piece-player2 { background-color: var(--p2-color); }
        
        .status-area {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            border-top: 4px solid #f1f5f9;
            padding-top: 1rem;
        }

        #modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.98);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="w-full flex justify-between items-center mb-0">
            <button onclick="resetGame()" class="p-2 text-slate-500 hover:text-teal-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
            </button>
            
            <h1 class="text-4xl font-black tracking-tighter uppercase text-teal-950">Navakankari</h1>

            <button onclick="showRules()" class="p-2 text-slate-500 hover:text-teal-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
            </button>
        </div>

        <div id="instruction" class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 h-3 text-center">
            Tap to place piece
        </div>

        <div class="board-container" id="board"></div>

        <div class="status-area">
            <div class="flex flex-col gap-0.5">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full piece-player1"></div>
                    <span class="text-[10px] font-black uppercase tracking-widest text-teal-950">P1</span>
                </div>
                <span id="p1-count" class="text-[9px] text-slate-700 font-black ml-5">9 LEFT</span>
            </div>
            
            <div class="text-center px-6">
                <div id="game-phase" class="text-[8px] uppercase tracking-[0.4em] text-slate-500 font-black mb-0.5">PLACEMENT</div>
                <div id="turn-indicator" class="text-[11px] font-black uppercase text-teal-950 bg-teal-100 px-3 py-1 rounded-full">Player 1</div>
            </div>
            
            <div class="flex flex-col items-end gap-0.5">
                <div class="flex items-center gap-2">
                    <span class="text-[10px] font-black uppercase tracking-widest text-teal-950">P2</span>
                    <div class="w-3 h-3 rounded-full piece-player2"></div>
                </div>
                <span id="p2-count" class="text-[9px] text-slate-700 font-black mr-5">9 LEFT</span>
            </div>
        </div>
    </div>

    <div id="modal-overlay">
        <div class="w-full max-w-xs text-center">
            <h2 id="modal-title" class="text-4xl font-black uppercase tracking-tighter text-teal-950 mb-4"></h2>
            <div id="modal-content" class="text-[13px] text-teal-900/70 space-y-3 mb-8 leading-relaxed font-bold"></div>
            <button onclick="closeModal()" class="w-full py-5 bg-teal-950 text-white font-black uppercase tracking-[0.2em] text-[10px] hover:bg-teal-900 transition-all active:scale-95">Continue</button>
        </div>
    </div>

    <script>
        const POSITIONS = [
            { id: 0, x: 5, y: 5 }, { id: 1, x: 50, y: 5 }, { id: 2, x: 95, y: 5 },
            { id: 3, x: 20, y: 20 }, { id: 4, x: 50, y: 20 }, { id: 5, x: 80, y: 20 },
            { id: 6, x: 35, y: 35 }, { id: 7, x: 50, y: 35 }, { id: 8, x: 65, y: 35 },
            { id: 9, x: 5, y: 50 }, { id: 10, x: 20, y: 50 }, { id: 11, x: 35, y: 50 },
            { id: 12, x: 65, y: 50 }, { id: 13, x: 80, y: 50 }, { id: 14, x: 95, y: 50 },
            { id: 15, x: 35, y: 65 }, { id: 16, x: 50, y: 65 }, { id: 17, x: 65, y: 65 },
            { id: 18, x: 20, y: 80 }, { id: 19, x: 50, y: 80 }, { id: 20, x: 80, y: 80 },
            { id: 21, x: 5, y: 95 }, { id: 22, x: 50, y: 95 }, { id: 23, x: 95, y: 95 }
        ];

        const ADJACENCY = {
            0: [1, 9], 1: [0, 2, 4], 2: [1, 14],
            3: [4, 10], 4: [1, 3, 5, 7], 5: [4, 13],
            6: [7, 11], 7: [4, 6, 8], 8: [7, 12],
            9: [0, 10, 21], 10: [3, 9, 11, 18], 11: [6, 10, 15],
            12: [8, 13, 17], 13: [5, 12, 14, 20], 14: [2, 13, 23],
            15: [11, 16], 16: [15, 17, 19], 17: [12, 16],
            18: [10, 19], 19: [16, 18, 20, 22], 20: [13, 19],
            21: [9, 22], 22: [19, 21, 23], 23: [14, 22]
        };

        const MILLS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10, 11], [12, 13, 14], [15, 16, 17], [18, 19, 20], [21, 22, 23], 
            [0, 9, 21], [3, 10, 18], [6, 11, 15], [1, 4, 7], [16, 19, 22], [8, 12, 17], [5, 13, 20], [2, 14, 23] 
        ];

        let boardState = Array(24).fill(null);
        let currentPlayer = 1;
        let piecesToPlace = { 1: 9, 2: 9 };
        let piecesOnBoard = { 1: 0, 2: 0 };
        let gamePhase = 'placement'; 
        let selectedNode = null;

        const boardEl = document.getElementById('board');
        const instructionEl = document.getElementById('instruction');
        const turnIndicator = document.getElementById('turn-indicator');
        const phaseIndicator = document.getElementById('game-phase');

        function drawBoard() {
            boardEl.innerHTML = '';
            MILLS.forEach(mill => {
                drawLine(mill[0], mill[1]);
                drawLine(mill[1], mill[2]);
            });
            POSITIONS.forEach(pos => {
                const node = document.createElement('div');
                node.className = 'node';
                node.id = `node-${pos.id}`;
                node.style.left = `${pos.x}%`;
                node.style.top = `${pos.y}%`;
                node.onclick = () => handleNodeClick(pos.id);
                boardEl.appendChild(node);
                updateNodeUI(pos.id);
            });
        }

        function drawLine(idx1, idx2) {
            const p1 = POSITIONS[idx1], p2 = POSITIONS[idx2];
            const line = document.createElement('div');
            line.className = 'line';
            const x1 = p1.x, y1 = p1.y, x2 = p2.x, y2 = p2.y;
            const length = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));
            const angle = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;
            line.style.width = `${length}%`;
            line.style.height = `var(--line-thickness)`;
            line.style.left = `${x1}%`;
            line.style.top = `${y1}%`;
            line.style.transformOrigin = `0 50%`;
            line.style.transform = `rotate(${angle}deg)`;
            boardEl.appendChild(line);
        }

        function handleNodeClick(id) {
            if (gamePhase === 'placement') {
                if (boardState[id] === null) placePiece(id);
            } else if (gamePhase === 'movement') {
                if (boardState[id] === currentPlayer) {
                    selectPiece(id);
                } else if (selectedNode !== null && boardState[id] === null) {
                    movePiece(selectedNode, id);
                }
            } else if (gamePhase === 'mill') {
                if (boardState[id] !== null && boardState[id] !== currentPlayer) {
                    removePiece(id);
                }
            }
        }

        function placePiece(id) {
            boardState[id] = currentPlayer;
            piecesToPlace[currentPlayer]--;
            piecesOnBoard[currentPlayer]++;
            updateNodeUI(id);
            if (!checkMill(id)) {
                if (piecesToPlace[1] === 0 && piecesToPlace[2] === 0) gamePhase = 'movement';
                switchTurn();
            }
            updateStats();
        }

        function selectPiece(id) {
            if (selectedNode !== null) document.getElementById(`node-${selectedNode}`).classList.remove('highlight');
            if (selectedNode === id) { selectedNode = null; return; }
            selectedNode = id;
            document.getElementById(`node-${selectedNode}`).classList.add('highlight');
            instructionEl.innerText = "Select Target";
        }

        function movePiece(from, to) {
            const isFlying = piecesOnBoard[currentPlayer] === 3;
            const isAdjacent = ADJACENCY[from].includes(to);
            if (isFlying || isAdjacent) {
                boardState[from] = null;
                boardState[to] = currentPlayer;
                updateNodeUI(from);
                updateNodeUI(to);
                document.getElementById(`node-${from}`).classList.remove('highlight');
                selectedNode = null;
                if (!checkMill(to)) switchTurn();
            }
        }

        function removePiece(id) {
            const opponent = currentPlayer === 1 ? 2 : 1;
            if (isPositionInMill(id)) {
                const allInMills = boardState.every((owner, idx) => owner === opponent ? isPositionInMill(idx) : true);
                if (!allInMills) return;
            }
            boardState[id] = null;
            piecesOnBoard[opponent]--;
            updateNodeUI(id);
            gamePhase = (piecesToPlace[1] > 0 || piecesToPlace[2] > 0) ? 'placement' : 'movement';
            if (checkGameOver()) return;
            switchTurn();
            updateStats();
        }

        function isPositionInMill(id) {
            const owner = boardState[id];
            if (!owner) return false;
            return MILLS.some(mill => mill.includes(id) && boardState[mill[0]] === owner && boardState[mill[1]] === owner && boardState[mill[2]] === owner);
        }

        function checkMill(id) {
            if (isPositionInMill(id)) {
                gamePhase = 'mill';
                instructionEl.innerText = "Capture Enemy";
                instructionEl.classList.remove('text-slate-600');
                instructionEl.classList.add('text-red-600');
                updateStats();
                return true;
            }
            return false;
        }

        function switchTurn() {
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            turnIndicator.innerText = `Player ${currentPlayer}`;
            instructionEl.classList.remove('text-red-600');
            instructionEl.classList.add('text-slate-600');
            if (gamePhase !== 'mill') {
                if (gamePhase === 'placement') instructionEl.innerText = "Tap to place piece";
                else instructionEl.innerText = piecesOnBoard[currentPlayer] === 3 ? "Fly: Move Anywhere" : "Select Piece to Move";
            }
        }

        function updateNodeUI(id) {
            const node = document.getElementById(`node-${id}`);
            if (!node) return;
            node.innerHTML = '';
            if (boardState[id] !== null) {
                const piece = document.createElement('div');
                piece.className = `piece piece-player${boardState[id]}`;
                node.appendChild(piece);
            }
        }

        function updateStats() {
            document.getElementById('p1-count').innerText = piecesToPlace[1] > 0 ? `${piecesToPlace[1]} LEFT` : `${piecesOnBoard[1]} BOARD`;
            document.getElementById('p2-count').innerText = piecesToPlace[2] > 0 ? `${piecesToPlace[2]} LEFT` : `${piecesOnBoard[2]} BOARD`;
            phaseIndicator.innerText = gamePhase.toUpperCase();
        }

        function checkGameOver() {
            const opponent = currentPlayer === 1 ? 2 : 1;
            if (gamePhase !== 'placement' && piecesOnBoard[opponent] < 3) { showVictory(currentPlayer); return true; }
            return false;
        }

        function showVictory(player) {
            showMessage(`Victory`, `Player ${player} has dominated the board.`);
            resetGame();
        }

        function showRules() {
            const rules = `
                <p><strong>Placement:</strong> Take turns placing your 9 pieces.</p>
                <p><strong>Movement:</strong> Move pieces along lines to adjacent spots.</p>
                <p><strong>Mills:</strong> 3 in a row captures 1 enemy piece.</p>
                <p><strong>End Game:</strong> Reduce enemy to 2 pieces to win.</p>
            `;
            showMessage("Manual", rules);
        }

        function showMessage(title, content) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

        function resetGame() {
            boardState = Array(24).fill(null);
            currentPlayer = 1;
            piecesToPlace = { 1: 9, 2: 9 };
            piecesOnBoard = { 1: 0, 2: 0 };
            gamePhase = 'placement';
            selectedNode = null;
            drawBoard();
            updateStats();
            switchTurn();
        }

        window.addEventListener('resize', drawBoard);
        window.onload = resetGame;
    </script>
</body>
</html>